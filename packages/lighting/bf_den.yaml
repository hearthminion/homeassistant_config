---
# ==================================================================================================
#
# BF: Den
#
# ==================================================================================================
adaptive_lighting:
  - name: "BF1: Den CF1"
    lights:
      - light.bf1_den_cf1
    initial_transition: 1
    min_color_temp: 2000
    max_color_temp: 6500

  - name: "BF1: Den CF2"
    lights:
      - light.bf1_den_cf2
    initial_transition: 1
    min_color_temp: 2000
    max_color_temp: 6500

  - name: "BF1: Den Lamp1"
    lights:
      - light.bf1_den_lamp1
    initial_transition: 1
    min_color_temp: 2000
    max_color_temp: 6500

  - name: "BF1: Den Lamp2"
    lights:
      - light.bf1_den_lamp2
    initial_transition: 1
    min_color_temp: 2000
    max_color_temp: 6500

  - name: "BF1: Den Lamp3"
    lights:
      - light.bf1_den_lamp3
    initial_transition: 1
    min_color_temp: 2000
    max_color_temp: 6500

# ==================================================================================================
#
# Automations
#
# ==================================================================================================
automation:
  # ================================================================================================
  #
  # Whole Room
  #
  # ================================================================================================
  - id: "4c6e9101-a48b-480f-bd66-ad4b5fe13ac2"
    alias: "BF1: Den - Adaptive Lighting (Toggle)"
    trigger:
      - platform: state
        entity_id: binary_sensor.bf1_den_color_mode
    variables:
      adaptive_mode: "{{ iif(is_state('binary_sensor.bf1_den_color_mode','on'), 'off','on') }}"
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: "{{ is_state('input_select.light_mode', 'Circadian') }}"
    action:
      - service: "switch.turn_{{ adaptive_mode }}"
        data:
          entity_id:
            - switch.bf1_den_cf1_adaptive_lighting_brightness
            - switch.bf1_den_cf2_adaptive_lighting_brightness
            - switch.bf1_den_lamp1_adaptive_lighting_brightness
            - switch.bf1_den_lamp2_adaptive_lighting_brightness
            - switch.bf1_den_lamp3_adaptive_lighting_brightness
            - switch.bf1_den_cf1_adaptive_lighting_color
            - switch.bf1_den_cf2_adaptive_lighting_color
            - switch.bf1_den_lamp1_adaptive_lighting_color
            - switch.bf1_den_lamp2_adaptive_lighting_color
            - switch.bf1_den_lamp3_adaptive_lighting_color
    mode: single

  - id: "a068ce76-cc17-4d03-a706-5e72bdd7f542"
    alias: "BF1: Den - Update Selected Scene"
    trigger:
      - platform: state
        entity_id: input_select.bf1_den_scene
    condition:
      - condition: template
        value_template: "{{ trigger.to_state != trigger.from_state }}"
    action:
      service: scene.turn_on
      data_template:
        entity_id: >
          {{ states('input_select.bf1_den_scene') }}
    mode: single

  - id: "55cd64c4-64f3-45e0-9e49-44c666ee5df1"
    alias: "BF1: Den - Auto populate Hue dynamic scene input select"
    trigger:
      - platform: event
        event_type: delayed_homeassistant_start
    action:
      service: input_select.set_options
      target:
        entity_id: input_select.bf1_den_dynamic_scenes
      data:
        options: >
          {{ states.scene
            | selectattr('attributes.group_name','eq','BF1: Den')
            | selectattr('attributes.is_dynamic','eq',true)
            | map(attribute='name')
            | list }}
    mode: restart

  # ================================================================================================
  #
  # BF1: Den CF1
  #
  # ================================================================================================
  - id: "a295f04d-9e1e-4b57-80ae-b4dea525742d"
    alias: "BF1: Den CF1 - Adaptive Lighting (Toggle Brightness Adjustment)"
    trigger:
      - platform: state
        entity_id: input_select.light_mode
        to: "Circadian"
      - platform: state
        entity_id: binary_sensor.bf1_den_cf1_autobrightness
    variables:
      brightness_mode: "{{ states('binary_sensor.bf1_den_cf1_autobrightness') }}"
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: "{{ is_state('input_select.light_mode', 'Circadian') }}"
    action:
      - service: "switch.turn_{{ brightness_mode }}"
        data:
          entity_id:
            - switch.bf1_den_cf1_adaptive_lighting_brightness
    mode: single

  - id: "5767f02e-cf98-4a58-935d-23008b0c4b29"
    alias: "BF1: Den CF1 - Adaptive Lighting (Turn Off Brightness Adjustment)"
    description: ""
    trigger:
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 3
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 2
    condition: []
    action:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
            - switch.bf1_den_cf1_adaptive_lighting_brightness
    mode: single

  - id: "4227c801-66c4-439f-ba9d-8a478d67a497"
    alias: "BF1: Den CF1 - Adaptive Lighting (Toggle Color Adjustment)"
    trigger:
      - platform: state
        entity_id: input_select.light_mode
        to: "Circadian"
      - platform: state
        entity_id: binary_sensor.bf1_den_cf1_autocolor
    variables:
      brightness_mode: "{{ states('binary_sensor.bf1_den_cf1_autocolor') }}"
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: "{{ is_state('input_select.light_mode', 'Circadian') }}"
    action:
      - service: "switch.turn_{{ brightness_mode }}"
        data:
          entity_id:
            - switch.bf1_den_cf1_adaptive_lighting_color
    mode: single

  - id: "7df3d18c-0692-4307-bd22-9d21f6fafc8f"
    alias: "BF1: Den CF1 - Adaptive Lighting (Turn Off Color Adjustment)"
    description: ""
    trigger:
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 4
            type: "long_release"
    condition: []
    action:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
            - switch.bf1_den_cf1_adaptive_lighting_color
    mode: single

  - id: "d82d5d46-b56b-4587-8978-1fa151d2b666"
    alias: "BF1: Den CF1 - Green Has Been On"
    description: ""
    trigger:
      - platform: state
        entity_id: light.bf1_den_cf1
        attribute: xy_color
        to: (0.23, 0.698)
    condition: []
    action:
      - entity_id: input_boolean.bf1_den_cf1_green_event
        service: input_boolean.turn_on
      - entity_id: input_boolean.special_migraine_mode
        service: input_boolean.turn_on
    mode: single

  - id: "1638cbed-885f-435e-b200-324d14755a9cU"
    alias: "BF1: Den CF1 - Turn off Green tracker"
    description: ""
    trigger:
      - at: "04:00"
        platform: time
    condition: []
    action:
      - entity_id: input_boolean.bf1_den_cf1_green_event
        service: input_boolean.turn_off
    mode: single

  # ================================================================================================
  #
  # BF1: Den CF2
  #
  # ================================================================================================
  - id: "2bb7e80d-9401-4294-97fa-ed54926aaeae"
    alias: "BF1: Den CF2 - Adaptive Lighting (Toggle Brightness Adjustment)"
    trigger:
      - platform: state
        entity_id: input_select.light_mode
        to: "Circadian"
      - platform: state
        entity_id: binary_sensor.bf1_den_cf2_autobrightness
    variables:
      brightness_mode: "{{ states('binary_sensor.bf1_den_cf2_autobrightness') }}"
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: "{{ is_state('input_select.light_mode', 'Circadian') }}"
    action:
      - service: "switch.turn_{{ brightness_mode }}"
        data:
          entity_id:
            - switch.bf1_den_cf2_adaptive_lighting_brightness
    mode: single

  - id: "28bb11af-1d93-4271-bd3b-a64d72e5e861"
    alias: "BF1: Den CF2 - Adaptive Lighting (Turn Off Brightness Adjustment)"
    description: ""
    trigger:
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 3
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 2
    condition: []
    action:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
            - switch.bf1_den_cf2_adaptive_lighting_brightness
    mode: single

  - id: "d82d5d46-b56b-4587-8978-1fa151d2b666"
    alias: "BF1: Den CF1 - Green Has Been On"
    description: ""
    trigger:
      - platform: state
        entity_id: light.bf1_den_cf2
        attribute: xy_color
        to: (0.23, 0.698)
    condition: []
    action:
      - entity_id: input_boolean.bf1_den_cf2_green_event
        service: input_boolean.turn_on
      - entity_id: input_boolean.special_migraine_mode
        service: input_boolean.turn_on
    mode: single

  - id: "1638cbed-885f-435e-b200-324d14755a9cU"
    alias: "BF1: Den CF1 - Turn off Green tracker"
    description: ""
    trigger:
      - at: "04:00"
        platform: time
    condition: []
    action:
      - entity_id: input_boolean.bf1_den_cf2_green_event
        service: input_boolean.turn_off
    mode: single


  # ================================================================================================
  #
  # BF1: Den Lamp1
  #
  # ================================================================================================
  - id: "856093cd-615e-481c-a8cb-c8625aa70f43"
    alias: "BF1: Den Lamp1 - Adaptive Lighting (Toggle Brightness Adjustment)"
    trigger:
      - platform: state
        entity_id: input_select.light_mode
        to: "Circadian"
      - platform: state
        entity_id: binary_sensor.bf1_den_lamp1_autobrightness
    variables:
      brightness_mode: "{{ states('binary_sensor.bf1_den_lamp1_autobrightness') }}"
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: "{{ is_state('input_select.light_mode', 'Circadian') }}"
    action:
      - service: "switch.turn_{{ brightness_mode }}"
        data:
          entity_id:
            - switch.bf1_den_lamp1_adaptive_lighting_brightness
    mode: single

  - id: "85f03946-6f35-480b-81a7-6dde04d6b583"
    alias: "BF1: Den Lamp1 - Adaptive Lighting (Turn Off Brightness Adjustment)"
    description: ""
    trigger:
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 3
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 2
    condition: []
    action:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
            - switch.bf1_den_lamp1_adaptive_lighting_brightness
    mode: single

  # ================================================================================================
  #
  # BF1: Den Lamp2
  #
  # ================================================================================================
  - id: "c1598496-1a45-4199-bc5b-64d11ba6b393"
    alias: "BF1: Den Lamp2 - Adaptive Lighting (Toggle Brightness Adjustment)"
    trigger:
      - platform: state
        entity_id: input_select.light_mode
        to: "Circadian"
      - platform: state
        entity_id: binary_sensor.bf1_den_lamp2_autobrightness
    variables:
      brightness_mode: "{{ states('binary_sensor.bf1_den_lamp2_autobrightness') }}"
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: "{{ is_state('input_select.light_mode', 'Circadian') }}"
    action:
      - service: "switch.turn_{{ brightness_mode }}"
        data:
          entity_id:
            - switch.bf1_den_lamp2_adaptive_lighting_brightness
    mode: single

  - id: "8a16a438-7064-46e3-83f4-3c9c30286613"
    alias: "BF1: Den Lamp2 - Adaptive Lighting (Turn Off Brightness Adjustment)"
    description: ""
    trigger:
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 3
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 2
    condition: []
    action:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
            - switch.bf1_den_lamp2_adaptive_lighting_brightness
    mode: single

  - id: "26890e24-029c-42e6-a3db-5d64b978f989"
    alias: "BF1: Den Lamp2 - Adaptive Lighting (Toggle Color Adjustment)"
    trigger:
      - platform: state
        entity_id: input_select.light_mode
        to: "Circadian"
      - platform: state
        entity_id: binary_sensor.bf1_den_lamp2_autocolor
    variables:
      brightness_mode: "{{ states('binary_sensor.bf1_den_lamp2_autocolor') }}"
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: "{{ is_state('input_select.light_mode', 'Circadian') }}"
    action:
      - service: "switch.turn_{{ brightness_mode }}"
        data:
          entity_id:
            - switch.bf1_den_lamp2_adaptive_lighting_color
    mode: single

  - id: "7df3d18c-0692-4307-bd22-9d21f6fafc8f"
    alias: "BF1: Den CF1 - Adaptive Lighting (Turn Off Color Adjustment)"
    description: ""
    trigger:
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 4
            type: "long_release"
    condition: []
    action:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
            - switch.bf1_den_lamp2_adaptive_lighting_color
    mode: single


  - id: "d82d5d46-b56b-4587-8978-1fa151d2b666"
    alias: "BF1: Den Lamp2 - Green Tracker (Turn On)"
    description: ""
    trigger:
      - entity_id: sensor.bf1_den_lamp2_color
        platform: state
        to: (0.23, 0.698)
    condition: []
    action:
      - entity_id: input_boolean.bf1_den_lamp2_green_event
        service: input_boolean.turn_on

  - id: "cb8b4633-4a47-477e-9391-240ba6c7d71c"
    alias: "BF1: Den Lamp2 - Green Tracker (Turn Off)"
    description: ""
    trigger:
      - at: "04:00"
        platform: time
    condition: []
    action:
      - entity_id: input_boolean.bf1_den_lamp2_green_event
        service: input_boolean.turn_off
    mode: single

  # ================================================================================================
  #
  # BF1: Den Lamp1
  #
  # ================================================================================================
  - id: "37ba0e30-fec3-42ad-ae96-ad6378ebf63a"
    alias: "BF1: Den Lamp3 - Adaptive Lighting (Toggle Brightness Adjustment)"
    trigger:
      - platform: state
        entity_id: input_select.light_mode
        to: "Circadian"
      - platform: state
        entity_id: binary_sensor.bf1_den_lamp3_autobrightness
    variables:
      brightness_mode: "{{ states('binary_sensor.bf1_den_lamp3_autobrightness') }}"
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: "{{ is_state('input_select.light_mode', 'Circadian') }}"
    action:
      - service: "switch.turn_{{ brightness_mode }}"
        data:
          entity_id:
            - switch.bf1_den_lamp3_adaptive_lighting_brightness
    mode: single

  - id: "1a482491-906a-4d50-ac19-3e0a1585ab5a"
    alias: "BF1: Den Lamp3 - Adaptive Lighting (Turn Off Brightness Adjustment)"
    description: ""
    trigger:
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 3
        - platform: event
          event_type: hue_event
          event_data:
            id: bf1_great_room_switch_button
            subtype: 2
    condition: []
    action:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
            - switch.bf1_den_lamp3_adaptive_lighting_brightness
    mode: single

# ==================================================================================================
#
# Input Boolean
#
# ==================================================================================================
input_boolean:

  bf1_den_all_lights:
    name: "BF1: Den - All"


  # ================================================================================================
  #
  # The next two input_boolean entities are used to track if the light has been turned green today
  #
  # ================================================================================================
  bf1_den_cf1_green_event:
    name: "BF1: Den CF1 - Green Event"

  bf1_den_cf2_green_event:
    name: "BF1: Den CF2 - Green Event"

  bf1_den_lamp1_green_event:
    name: "BF1: Den Lamp1 - Green Event"

  bf1_den_lamp2_green_event:
    name: "BF1: Den Lamp2 - Green Event"

  bf1_den_lamp3_green_event:
    name: "BF1: Den Lamp3 - Green Event"

# ==================================================================================================
#
# Input Number
#
# ==================================================================================================
input_number:
  bf1_den_dynamic_scene_speed:
    name: "BF1: Den - Dynamic Scene Speed"
    min: 0
    max: 100
    step: 10

  bf1_den_dynamic_scene_brightness:
    name: "BF1: Den - Dynamic Scene Brightness"
    min: 0
    max: 255
    step: 10

# ==================================================================================================
#
# Input Select
#
# ==================================================================================================
input_select:
  bf1_den_lights_scene:
    name: "BF1: Den - Scene"
    options:
      - scene.bf1_den_bright
      - scene.bf1_den_candle
      - scene.bf1_den_concentrate
      - scene.bf1_den_darken
      - scene.bf1_den_dimmed
      - scene.bf1_den_energize
      - scene.bf1_den_fireplace
      - scene.bf1_den_homeassistant
      - scene.bf1_den_migraine
      - scene.bf1_den_nightlight
      - scene.bf1_den_read
      - scene.bf1_den_relax
      - scene.bf1_den_dynamic

  bf1_den_dynamic_scenes:
    name: "BF1: Den - Dynamic Scene"
    options:
      - Bright

  bf1_den_cf1_scene:
    name: "BF1: Den CF1 - Scene"
    options:
      - scene.bf1_den_cf1_bright
      - scene.bf1_den_cf1_concentrate
      - scene.bf1_den_cf1_darken
      - scene.bf1_den_cf1_dimmed
      - scene.bf1_den_cf1_energize
      - scene.bf1_den_cf1_homeassistant
      - scene.bf1_den_cf1_migraine
      - scene.bf1_den_cf1_nightlight
      - scene.bf1_den_cf1_read
      - scene.bf1_den_cf1_relax

  bf1_den_cf2_scene:
    name: "BF1: Den CF2 - Scene"
    options:
      - scene.bf1_den_cf2_bright
      - scene.bf1_den_cf2_concentrate
      - scene.bf1_den_cf2_dimmed
      - scene.bf1_den_cf2_energize
      - scene.bf1_den_cf2_homeassistant
      - scene.bf1_den_cf2_nightlight
      - scene.bf1_den_cf2_read
      - scene.bf1_den_cf2_relax

  bf1_den_lamp1_scene:
    name: "BF1: Den Lamp1 - Scene"
    options:
      - scene.bf1_den_lamp1_bright
      - scene.bf1_den_lamp1_concentrate
      - scene.bf1_den_lamp1_dimmed
      - scene.bf1_den_lamp1_energize
      - scene.bf1_den_lamp1_homeassistant
      - scene.bf1_den_lamp1_nightlight
      - scene.bf1_den_lamp1_read
      - scene.bf1_den_lamp1_relax

  bf1_den_lamp2_scene:
    name: "BF1: Den Lamp2 - Scene"
    options:
      - scene.bf1_den_lamp2_bright
      - scene.bf1_den_lamp2_candle
      - scene.bf1_den_lamp2_concentrate
      - scene.bf1_den_lamp2_darken
      - scene.bf1_den_lamp2_dimmed
      - scene.bf1_den_lamp2_energize
      - scene.bf1_den_lamp2_fireplace
      - scene.bf1_den_lamp2_homeassistant
      - scene.bf1_den_lamp2_migraine
      - scene.bf1_den_lamp2_nightlight
      - scene.bf1_den_lamp2_read
      - scene.bf1_den_lamp2_relax

  bf1_den_lamp3_scene:
    name: "BF1: Den Lamp3 - Scene"
    options:
      - scene.bf1_den_lamp3_bright
      - scene.bf1_den_lamp3_concentrate
      - scene.bf1_den_lamp3_dimmed
      - scene.bf1_den_lamp3_energize
      - scene.bf1_den_lamp3_homeassistant
      - scene.bf1_den_lamp3_nightlight
      - scene.bf1_den_lamp3_read
      - scene.bf1_den_lamp3_relax

# ==================================================================================================
#
# Template Lights
#
# ==================================================================================================
light:
  - platform: template
    lights:
      bf1_den_alt:
        friendly_name: "BF1: Den (Alt)"
        unique_id: "80cb201a-52a0-48c3-992e-4bf8c4e51a1f"
        value_template: "{{ states('light.bf1_den') }}"
        level_template: "{{ state_attr('light.bf1_den','brightness') | int }}"
        temperature_template: "{{ state_attr('light.bf1_den','color_temp') | int }}"
        color_template: "{{ state_attr('light.bf1_den','hs_color') }}"
        min_mireds_template: "{{ state_attr('light.bf1_den','min_mireds') | int }}"
        max_mireds_template: "{{ state_attr('light.bf1_den','max_mireds') | int }}"
        turn_on:
          service: scene.turn_on
          data_template:
            entity_id: >
              {{ states('input_select.bf1_den_scene') }}
        turn_off:
          service: light.turn_off
          target:
            entity_id: light.bf1_den



        
# ==================================================================================================
#
# Rest Commands
#
# ==================================================================================================
rest_command:
  light_update_bf1_den_scene:
    url: "https://hue2.iot.home/clip/v2/resource/scene/{{ scene_id }}"
    method: put
    headers:
      hue-application-key: "{{ username }}"
    payload: '{
          "id":"{{ scene_id }}",
          "actions":[
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "5d9e8921-1307-4181-826e-55c3a05e14ac","rtype":"light"}
          },
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "84e56e8b-a96f-4a25-9715-4ecc0921ab8d","rtype":"light"}
          },
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "e464775c-3b2b-453d-b7cf-e7def42610f6","rtype":"light"}
          },
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "8677b6df-8d08-4eba-a4c5-927d3321915d","rtype":"light"}
          },
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "2b238059-189a-4f70-b33a-6b6948b70dc7","rtype":"light"}
          },
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "b02df779-caaa-446a-8e0e-e73e069f9cbd","rtype":"light"}
          }
          ]
          }'
    verify_ssl: false
    content_type: "application/json"

  light_update_bf1_den_lamp1_scene:
    url: "https://hue2.iot.home/clip/v2/resource/scene/{{ scene_id }}"
    method: put
    headers:
      hue-application-key: "{{ username }}"
    payload: '{
          "id":"{{ scene_id }}",
          "actions":[
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "5d9e8921-1307-4181-826e-55c3a05e14ac","rtype":"light"}
          }
          ]
          }'
    verify_ssl: false
    content_type: "application/json"

  light_update_bf1_den_lamp2_scene:
    url: "https://hue2.iot.home/clip/v2/resource/scene/{{ scene_id }}"
    method: put
    headers:
      hue-application-key: "{{ username }}"
    payload: '{
          "id":"{{ scene_id }}",
          "actions":[
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "84e56e8b-a96f-4a25-9715-4ecc0921ab8d","rtype":"light"}
          }
          ]
          }'
    verify_ssl: false
    content_type: "application/json"

  light_update_bf1_den_lamp3_scene:
    url: "https://hue2.iot.home/clip/v2/resource/scene/{{ scene_id }}"
    method: put
    headers:
      hue-application-key: "{{ username }}"
    payload: '{
          "id":"{{ scene_id }}",
          "actions":[
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "e464775c-3b2b-453d-b7cf-e7def42610f6","rtype":"light"}
          },
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "8677b6df-8d08-4eba-a4c5-927d3321915d","rtype":"light"}
          }
          ]
          }'
    verify_ssl: false
    content_type: "application/json"

  light_update_bf1_den_cf1_scene:
    url: "https://hue2.iot.home/clip/v2/resource/scene/{{ scene_id }}"
    method: put
    headers:
      hue-application-key: "{{ username }}"
    payload: '{
          "id":"{{ scene_id }}",
          "actions":[
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "2b238059-189a-4f70-b33a-6b6948b70dc7","rtype":"light"}
          }
          ]
          }'
    verify_ssl: false
    content_type: "application/json"

  light_update_bf1_den_cf2_scene:
    url: "https://hue2.iot.home/clip/v2/resource/scene/{{ scene_id }}"
    method: put
    headers:
      hue-application-key: "{{ username }}"
    payload: '{
          "id":"{{ scene_id }}",
          "actions":[
          {
          "action":{ {{ color }},{{ brightness }},{{ on_state }} },
          "target":{"rid": "b02df779-caaa-446a-8e0e-e73e069f9cbd","rtype":"light"}
          }
          ]
          }'
    verify_ssl: false
    content_type: "application/json"

# ==================================================================================================
#
# Scenes
#
# Hue Groups:
#   - den_lamp1: e8c3191a-6cf0-4339-9fd6-a86761162a30
#     
#
#
#
#
# ==================================================================================================
scene:
  # ================================================================================================
  #
  # Whole Room
  #
  # ================================================================================================
  - id: "1a6bced9-d9d0-4bc5-ba4b-04856ab65016"
    name: "BF1: Den - Darken"
    entities:
      light.bf1_den_lamp2_bulb:
        state: "on"
        xy_color:
          - 0.6915
          - 0.3083
        brightness: 64
      light.bf1_den_cf1_bulb:
        state: "on"
        xy_color:
          - 0.6915
          - 0.3083
        brightness: 64
      light.bf1_den_cf2_bulb:
        state: "off"
      light.bf1_den_lamp1_bulb:
        state: "off"
      light.bf1_den_lamp3_bulb_1:
        state: "off"
      light.bf1_den_lamp3_bulb_2:
        state: "off"

  - id: "23d13269-6154-4b8d-9fbc-473e1cd5cade"
    name: "BF1: Den - Migraine"
    entities:
      light.bf1_den_lamp2_bulb:
        state: "on"
        xy_color:
          - 0.23
          - 0.698
        brightness: 64
      light.bf1_den_cf1_bulb:
        state: "on"
        xy_color:
          - 0.23
          - 0.698
        brightness: 64
      light.bf1_den_cf2_bulb:
        state: "off"
      light.bf1_den_lamp1_bulb:
        state: "off"
      light.bf1_den_lamp3_bulb_1:
        state: "off"
      light.bf1_den_lamp3_bulb_2:
        state: "off"

  - id: "e22fe978-0ef1-40ff-8318-f823d40d4afc"
    name: "BF1: Den - Bright"
    entities:
      light.bf1_den:
        state: "on"
        color_temp: 367
        brightness: 255

  - id: "56f372b6-6671-4822-944e-a3acf87e0d44"
    name: "BF1: Den - Concentrate"
    entities:
      light.bf1_den:
        state: "on"
        color_temp: 230
        brightness: 255

  - id: "2a58b5f2-eaf2-42c2-8bdf-16803f3a353f"
    name: "BF1: Den - Dimmed"
    entities:
      light.bf1_den:
        state: "on"
        color_temp: 369
        brightness: 76

  - id: "b82e0bc9-96c4-4f6c-a893-256845cc40f0"
    name: "BF1: Den - Energize"
    entities:
      light.bf1_den:
        state: "on"
        color_temp: 156
        brightness: 255

  - id: "6cf4fe95-ab39-44a5-ae1b-c39fa505f4e6"
    name: "BF1: Den - Nightlight"
    entities:
      light.bf1_den:
        state: "on"
        color_temp: 454
        brightness: 1

  - id: "61347ccd-2929-416c-8b44-ec3d0f79fe24"
    name: "BF1: Den - Read"
    entities:
      light.bf1_den:
        state: "on"
        color_temp: 343
        brightness: 255

  - id: "72a07da5-a6b2-403e-a26e-29322e5cd272"
    name: "BF1: Den - Relax"
    entities:
      light.bf1_den:
        state: "on"
        color_temp: 447
        brightness: 145

  - id: "75ebf157-d318-48d2-849e-2adc16b83ff1"
    name: "BF1: Den - Off"
    entities:
      light.bf1_den:
        state: "off"

  - id: "036daf4c-026f-417b-b3e3-9bba14f040bb"
    name: "BF1: Den CF1 - Darken"
    entities:
      light.bf1_den_cf1_bulb:
        state: "on"
        xy_color:
          - 0.6915
          - 0.3083
        brightness: 64

  - id: "a39d81fa-b875-4810-a587-273af02a7841"
    name: "BF1: Den CF1 - Migraine"
    entities:
      light.bf1_den_cf1_bulb:
        state: "on"
        xy_color:
          - 0.23
          - 0.698
        brightness: 64

  - id: "892118cd-664d-4373-9d42-1a511fe39e4c"
    name: "BF1: Den CF1 - Bright"
    entities:
      light.bf1_den_cf1:
        state: "on"
        color_temp: 367
        brightness: 255

  - id: "e5314906-7755-4632-a5c7-fbdb6ab3688b"
    name: "BF1: Den CF1 - Concentrate"
    entities:
      light.bf1_den_cf1:
        state: "on"
        color_temp: 230
        brightness: 255

  - id: "a9f42803-c0a6-474d-8fe6-d0cc45942f05"
    name: "BF1: Den CF1 - Dimmed"
    entities:
      light.bf1_den_cf1:
        state: "on"
        color_temp: 369
        brightness: 76

  - id: "96a5fc4b-bf8c-4bfc-99a5-22faac4718a3"
    name: "BF1: Den CF1 - Energize"
    entities:
      light.bf1_den_cf1:
        state: "on"
        color_temp: 156
        brightness: 255

  - id: "093ab12a-6049-4b0a-bb17-d0c8a58339a2"
    name: "BF1: Den CF1 - Relax"
    entities:
      light.bf1_den_cf1:
        state: "on"
        color_temp: 447
        brightness: 145

  - id: "1063de13-3010-49d8-ac0c-0faf52521723"
    name: "BF1: Den CF1 - Off"
    entities:
      light.bf1_den_cf1:
        state: "off"

  - id: "05adc376-5509-46f2-b00b-0adcc56ff071"
    name: "BF1: Den CF2 - Bright"
    entities:
      light.bf1_den_cf2:
        state: "on"
        color_temp: 367
        brightness: 255

  - id: "739aba1d-601c-4136-a047-7e95929a4d22"
    name: "BF1: Den CF2 - Concentrate"
    entities:
      light.bf1_den_cf2:
        state: "on"
        color_temp: 230
        brightness: 255

  - id: "bb7348fe-6cca-429e-a2e7-0e0f27bf786e"
    name: "BF1: Den CF2 - Dimmed"
    entities:
      light.bf1_den_cf2:
        state: "on"
        color_temp: 369
        brightness: 76

  - id: "99597d73-4ff7-4d4b-868c-66cf04120715"
    name: "BF1: Den CF2 - Energize"
    entities:
      light.bf1_den_cf2:
        state: "on"
        color_temp: 156
        brightness: 255

  - id: "b0b2725d-eb16-4cf5-9e24-67199c52a9c1"
    name: "BF1: Den CF2 - Nightlight"
    entities:
      light.bf1_den_cf2:
        state: "on"
        color_temp: 454
        brightness: 1

  - id: "cdbff247-8b71-4419-8965-9d40989ceb14"
    name: "BF1: Den CF2 - Read"
    entities:
      light.bf1_den_cf2:
        state: "on"
        color_temp: 343
        brightness: 255

  - id: "d54157d0-55e8-
    406c-92c4-f0e8f3dcdb43"
    name: "BF1: Den CF2 - Relax"
    entities:
      light.bf1_den_cf2:
        state: "on"
        color_temp: 447
        brightness: 145

  - id: "16ddbe1a-61c0-4acc-a62f-760ff80906ab"
    name: "BF1: Den CF2 - Off"
    entities:
      light.bf1_den_cf2:
        state: "off"

  - id: "1a45d737-39cd-4785-82d6-b4f90e122e69"
    name: "BF1: Den Lamp 1 - Bright"
    entities:
      light.bf1_den_lamp1:
        state: "on"
        color_temp: 367
        brightness: 255

  - id: "12648b84-93d3-43a2-b4fd-d2805dd98407"
    name: "BF1: Den Lamp 1 - Concentrate"
    entities:
      light.bf1_den_lamp1:
        state: "on"
        color_temp: 230
        brightness: 255

  - id: "9adff70c-2589-4cc7-ab52-389b579c1636"
    name: "BF1: Den Lamp 1 - Dimmed"
    entities:
      light.bf1_den_lamp1:
        state: "on"
        color_temp: 369
        brightness: 76

  - id: "ed74691e-a94e-4977-a8c7-ccc7c908ed2e"
    name: "BF1: Den Lamp 1 - Energize"
    entities:
      light.bf1_den_lamp1:
        state: "on"
        color_temp: 156
        brightness: 255

  - id: "5031e294-15bb-4099-af30-0fda31c4881e"
    name: "BF1: Den Lamp 1 - Nightlight"
    entities:
      light.bf1_den_lamp1:
        state: "on"
        color_temp: 454
        brightness: 1

  - id: "a417a1da-8906-4e36-bb73-243a3d15cb01"
    name: "BF1: Den Lamp 1 - Read"
    entities:
      light.bf1_den_lamp1:
        state: "on"
        color_temp: 343
        brightness: 255

  - id: "5e1229fa-ef48-456d-8235-510c059251ab"
    name: "BF1: Den Lamp 1 - Relax"
    entities:
      light.bf1_den_lamp1:
        state: "on"
        color_temp: 447
        brightness: 145

  - id: "0051519b-8dae-4000-87c0-b9580ef29a3f"
    name: "BF1: Den Lamp 1 - Off"
    entities:
      light.bf1_den_lamp1:
        state: "off"

  - id: "5af2c88c-f065-4136-bb30-4e7f215539be"
    name: "BF1: Den Lamp 2 - Darken"
    entities:
      light.bf1_den_lamp2_bulb:
        state: "on"
        xy_color:
          - 0.689
          - 0.309
        brightness: 64

  - id: "8cfbff74-659b-4127-9d62-055c7f673415"
    name: "BF1: Den Lamp 2 - Migraine"
    entities:
      light.bf1_den_lamp2_bulb:
        state: "on"
        xy_color:
          - 0.23
          - 0.698
        brightness: 64

  - id: "1af10e06-b6da-47e1-844a-d57097429fed"
    name: "BF1: Den Lamp 2 - Moonlight"
    entities:
      light.bf1_den_lamp2:
        state: "on"
        brightness: 1
        xy_color:
          - 0.246
          - 0.2489

  - id: "9aae763e-377d-4685-bb2f-52f7f97a32d9"
    name: "BF1: Den Lamp 2 - Bright"
    entities:
      light.bf1_den_lamp2:
        state: "on"
        color_temp: 367
        brightness: 255

  - id: "27fadaf9-5df4-4ac3-b3d7-a95723dddd9f"
    name: "BF1: Den Lamp 2 - Concentrate"
    entities:
      light.bf1_den_lamp2:
        state: "on"
        color_temp: 230
        brightness: 255

  - id: "976303bd-e643-459a-a480-60b92a8b07a2"
    name: "BF1: Den Lamp 2 - Dimmed"
    entities:
      light.bf1_den_lamp2:
        state: "on"
        color_temp: 369
        brightness: 76

  - id: "2ee3d1e8-5886-4d3a-a181-1d9e951263d2"
    name: "BF1: Den Lamp 2 - Energize"
    entities:
      light.bf1_den_lamp2:
        state: "on"
        color_temp: 156
        brightness: 255

  - id: "2ce26df1-6bc7-4df9-80bb-93d983348ae5"
    name: "BF1: Den Lamp 2 - Nightlight"
    entities:
      light.bf1_den_lamp2:
        state: "on"
        color_temp: 500
        brightness: 1

  - id: "756fb577-e196-4e5f-b122-3283b8376c51"
    name: "BF1: Den Lamp 2 - Read"
    entities:
      light.bf1_den_lamp2:
        state: "on"
        color_temp: 343
        brightness: 255

  - id: "065eae2b-dc07-4cd6-9071-524504cf02bc"
    name: "BF1: Den Lamp 2 - Relax"
    entities:
      light.bf1_den_lamp2:
        state: "on"
        color_temp: 447
        brightness: 145

  - id: "8656bfea-0550-4612-a69f-a1b274b47964"
    name: "BF1: Den Lamp 2 - Off"
    entities:
      light.bf1_den_lamp2:
        state: "off"

  - id: "68462efd-312d-4dec-b0af-8e523d293f0a"
    name: "BF1: Den Lamp 3 - Bright"
    entities:
      light.bf1_den_lamp3:
        state: "on"
        color_temp: 367
        brightness: 255

  - id: "5515a484-53f8-4f9f-8d26-9f64345553d0"
    name: "BF1: Den Lamp 3 - Concentrate"
    entities:
      light.bf1_den_lamp3:
        state: "on"
        color_temp: 230
        brightness: 255

  - id: "20ee9e12-337b-471b-bd3d-1d5093b0e9aa"
    name: "BF1: Den Lamp 3 - Dimmed"
    entities:
      light.bf1_den_lamp3:
        state: "on"
        color_temp: 369
        brightness: 76

  - id: "5cb22ee2-1ccb-4bd8-9345-e150afd9bd03"
    name: "BF1: Den Lamp 3 - Energize"
    entities:
      light.bf1_den_lamp3:
        state: "on"
        color_temp: 156
        brightness: 255

  - id: "749a98a7-69f7-4f3d-bcad-60747052f6e5"
    name: "BF1: Den Lamp 3 - Nightlight"
    entities:
      light.bf1_den_lamp3:
        state: "on"
        color_temp: 454
        brightness: 1

  - id: "b8c793f0-deba-4f70-9930-76c8c2374211"
    name: "BF1: Den Lamp 3 - Read"
    entities:
      light.bf1_den_lamp3:
        state: "on"
        color_temp: 343
        brightness: 255

  - id: "f3c6ad5d-6de9-4049-a385-f96be736f240"
    name: "BF1: Den Lamp 3 - Relax"
    entities:
      light.bf1_den_lamp3:
        state: "on"
        color_temp: 447
        brightness: 145

  - id: "e8f0a085-0893-47be-93ad-bbd69705d3ec"
    name: "BF1: Den Lamp 3 - Off"
    entities:
      light.bf1_den_lamp3:
        state: "off"

# ==================================================================================================
#
# Templates
#
# ==================================================================================================
template:
  - binary_sensor:
      # ============================================================================================
      #
      # Whole Room Binary Sensors
      #
      # ============================================================================================
      - unique_id: "8026215e-768b-48e6-86af-7053c91ac3f6"
        name: "BF1: Den - Color Mode"
        state: "{{ is_state_attr('light.bf1_den','color_mode', 'xy') }}"

      # ============================================================================================
      #
      # BF1: Den CF1 Binary Sensors
      #
      # ============================================================================================
      - unique_id: "4e73e461-0de2-4211-a0a0-daba7d34b223"
        name: "BF1: Den CF1 - Autobrightness"
        state: >-
          {{ (
               states("sensor.global_dummy_light_brightness") | int(100) ) <
               ( state_attr("binary_sensor.bf1_den_cf1_autobrightness", "brightness_max")
               | int(104) )
             and ( states("sensor.global_dummy_light_brightness") | int(100) ) >
             ( state_attr("binary_sensor.bf1_den_cf1_autobrightness", "brightness_min") | int(96)
             ) }}
        attributes:
          brightness: >-
            {% if state_attr("light.bf1_den1_cf1", "brightness") is number %}
              {{ ( state_attr("light.bf1_den_cf1", "brightness") / 254 * 100 ) | int(100) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_brightness") | int(100) ) }}
            {% endif %}
          brightness_max: >-
            {{ state_attr("binary_sensor.bf1_den_cf1_autobrightness", "brightness") | int(100) + 4 }}
          brightness_min: >-
            {{ state_attr("binary_sensor.bf1_den_cf1_autobrightness", "brightness") | int(100) - 4 }}

      - unique_id: "323a0a4f-8adc-485b-844c-91011ca27147"
        name: "BF1: Den CF1 - Autocolor"
        state: >-
          {{ (
               states("sensor.global_dummy_light_color_temperature") | int(367) ) <
               ( state_attr("binary_sensor.bf1_den_cf1_autocolor", "color_temp_max")
               | int(371) )
             and ( states("sensor.global_dummy_light_color_temperature") | int(367) ) >
             ( state_attr("binary_sensor.bf1_den_cf1_autocolor", "color_temp_min") | int(363)
             ) }}
        attributes:
          color_temp: >-
            {% if state_attr("light.bf1_den_cf1", "color_temp") is number %}
              {{ state_attr("light.bf1_den_cf1","color_temp") | int(367) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_color_temperature") | int(367) ) }}
            {% endif %}
          color_temp_max: >-
            {{ state_attr("binary_sensor.bf1_den_cf1_autocolor", "color_temp") | int(367) + 4 }}
          color_temp_min: >-
            {{ state_attr("binary_sensor.bf1_den_cf1_autocolor", "color_temp") | int(367) - 4 }}

      - unique_id: "62828fad-c7ff-488d-b4e8-8abc61557edb"
        name: "BF1: Den CF1 - Scene Bright"
        state: >-
          {{ is_state_attr("light.bf1_den_cf1", "brightness", "255") and
             is_state_attr("light.bf1_den_cf1", "color_temp", "367") }}

      - unique_id: "62828fad-c7ff-488d-b4e8-8abc61557edb"
        name: "BF1: Den CF1 - Scene Concentrate"
        state: >-
          {{ is_state_attr("light.bf1_den_cf1", "brightness", "255") and
             is_state_attr("light.bf1_den_cf1", "color_temp", "230") }}

      # ============================================================================================
      #
      # BF1: Den CF2 Binary Sensors
      #
      # ============================================================================================
      - unique_id: "e7ce778a-148f-455e-8c58-373bc2c07c20"
        name: "BF1: Den CF2 - Autobrightness"
        state: >-
          {{ (
               states("sensor.global_dummy_light_brightness") | int(100) ) <
               ( state_attr("binary_sensor.bf1_den_cf2_autobrightness", "brightness_max")
               | int(104) )
             and ( states("sensor.global_dummy_light_brightness") | int(100) ) >
             ( state_attr("binary_sensor.bf1_den_cf2_autobrightness", "brightness_min") | int(100)
             ) }}
        attributes:
          brightness: >-
            {% if state_attr("light.bf1_den_cf2", "brightness") is number %}
              {{ ( state_attr("light.bf1_den_cf2","brightness") / 254 * 100 ) | int(100) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_brightness") | int(100) ) }}
            {% endif %}
          brightness_max: >-
            {{ state_attr("binary_sensor.bf1_den_cf2_autobrightness", "brightness") | int(100) + 4 }}
          brightness_min: >-
            {{ state_attr("binary_sensor.bf1_den_cf2_autobrightness", "brightness") | int(100) - 4 }}

      - unique_id: "26f9a3ca-b6aa-43b3-a958-769f03953408"
        name: "BF1: Den CF2 - Autocolor"
        state: >-
          {{ (
               states("sensor.global_dummy_light_color_temperature") | int(367) ) <
               ( state_attr("binary_sensor.bf1_den_cf2_autocolor", "color_temp_max")
               | int(371) )
             and ( states("sensor.global_dummy_light_color_temperature") | int(367) ) >
             ( state_attr("binary_sensor.bf1_den_cf2_autocolor", "color_temp_min") | int(363)
             ) }}
        attributes:
          color_temp: >-
            {% if state_attr("light.bf1_den_cf2", "color_temp") is number %}
              {{ state_attr("light.bf1_den_cf2","color_temp") | int(367) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_color_temperature") | int(367) ) }}
            {% endif %}
          color_temp_max: >-
            {{ state_attr("binary_sensor.bf1_den_cf2_autocolor", "color_temp") | int(100) + 4 }}
          color_temp_min: >-
            {{ state_attr("binary_sensor.bf1_den_cf2_autocolor", "color_temp") | int(100) - 4 }}


      # ============================================================================================
      #
      # BF1: Den Lamp1 Binary Sensors
      #
      # ============================================================================================
      - unique_id: "40ffe195-8dce-429b-9d93-86ab7b7a0c64"
        name: "BF1: Den Lamp1 - Autobrightness"
        state: >-
          {{ (
               states("sensor.global_dummy_light_brightness") | int(100) ) <
               ( state_attr("binary_sensor.bf1_den_lamp1_autobrightness", "brightness_max")
               | int(104) )
             and ( states("sensor.global_dummy_light_brightness") | int(100) ) >
             ( state_attr("binary_sensor.bf1_den_lamp1_autobrightness", "brightness_min") | int(100)
             ) }}
        attributes:
          brightness: >-
            {% if state_attr("light.bf1_den_lamp1", "brightness") is number %}
              {{ ( state_attr("light.bf1_den_lamp1","brightness") / 254 * 100 ) | int(100) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_brightness") | int(100) ) }}
            {% endif %}
          brightness_max: >-
            {{ state_attr("binary_sensor.bf1_den_lamp1_autobrightness", "brightness") | int(100) + 4 }}
          brightness_min: >-
            {{ state_attr("binary_sensor.bf1_den_lamp1_autobrightness", "brightness") | int(100) - 4 }}

      - unique_id: "a34519fb-38b3-4771-8609-a3dae4ba21fa"
        name: "BF1: Den Lamp1 - Autocolor"
        state: >-
          {{ (
               states("sensor.global_dummy_light_color_temperature") | int(367) ) <
               ( state_attr("binary_sensor.bf1_den_lamp1_autocolor", "color_temp_max")
               | int(371) )
             and ( states("sensor.global_dummy_light_color_temperature") | int(367) ) >
             ( state_attr("binary_sensor.bf1_den_lamp1_autocolor", "color_temp_min") | int(363)
             ) }}
        attributes:
          color_temp: >-
            {% if state_attr("light.bf1_den_lamp1", "color_temp") is number %}
              {{ state_attr("light.bf1_den_lamp1","color_temp") | int(367) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_color_temperature") | int(367) ) }}
            {% endif %}
          color_temp_max: >-
            {{ state_attr("binary_sensor.bf1_den_lamp1_autocolor", "color_temp") | int(100) + 4 }}
          color_temp_min: >-
            {{ state_attr("binary_sensor.bf1_den_lamp1_autocolor", "color_temp") | int(100) - 4 }}

      # ============================================================================================
      #
      # BF1: Den Lamp2 Binary Sensors
      #
      # ============================================================================================
      - unique_id: "c941d9d2-85ef-4148-b52a-1020a94c2225"
        name: "BF1: Den Lamp2 - Autobrightness"
        state: >-
          {{ (
               states("sensor.global_dummy_light_brightness") | int(100) ) <
               ( state_attr("binary_sensor.bf1_den_lamp2_autobrightness", "brightness_max")
               | int(104) )
             and ( states("sensor.global_dummy_light_brightness") | int(100) ) >
             ( state_attr("binary_sensor.bf1_den_lamp2_autobrightness", "brightness_min") | int(100)
             ) }}
        attributes:
          brightness: >-
            {% if state_attr("light.bf1_den_lamp2", "brightness") is number %}
              {{ ( state_attr("light.bf1_den_lamp2","brightness") / 254 * 100 ) | int(100) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_brightness") | int(100) ) }}
            {% endif %}
          brightness_max: >-
            {{ state_attr("binary_sensor.bf1_den_lamp2_autobrightness", "brightness") | int(100) + 4 }}
          brightness_min: >-
            {{ state_attr("binary_sensor.bf1_den_lamp2_autobrightness", "brightness") | int(100) - 4 }}

      - unique_id: "cfec1c05-a688-4f93-8618-427d7eefeac7"
        name: "BF1: Den Lamp2 - Autocolor"
        state: >-
          {{ (
               states("sensor.global_dummy_light_color_temperature") | int(367) ) <
               ( state_attr("binary_sensor.bf1_den_lamp2_autocolor", "color_temp_max")
               | int(371) )
             and ( states("sensor.global_dummy_light_color_temperature") | int(367) ) >
             ( state_attr("binary_sensor.bf1_den_lamp2_autocolor", "color_temp_min") | int(363)
             ) }}
        attributes:
          color_temp: >-
            {% if state_attr("light.bf1_den_lamp2", "color_temp") is number %}
              {{ state_attr("light.bf1_den_lamp2","color_temp") | int(367) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_color_temperature") | int(367) ) }}
            {% endif %}
          color_temp_max: >-
            {{ state_attr("binary_sensor.bf1_den_lamp2_autocolor", "color_temp") | int(100) + 4 }}
          color_temp_min: >-
            {{ state_attr("binary_sensor.bf1_den_lamp2_autocolor", "color_temp") | int(100) - 4 }}

      # ============================================================================================
      #
      # BF1: Den Lamp3 Binary Sensors
      #
      # ============================================================================================
      - unique_id: "d35877fb-db1e-47e0-bce0-a2517e0e8b92"
        name: "BF1: Den Lamp3 - Autobrightness"
        state: >-
          {{ (
               states("sensor.global_dummy_light_brightness") | int(100) ) <
               ( state_attr("binary_sensor.bf1_den_lamp3_autobrightness", "brightness_max")
               | int(104) )
             and ( states("sensor.global_dummy_light_brightness") | int(100) ) >
             ( state_attr("binary_sensor.bf1_den_lamp3_autobrightness", "brightness_min") | int(100)
             ) }}
        attributes:
          brightness: >-
            {% if state_attr("light.bf1_den_lamp3", "brightness") is number %}
              {{ ( state_attr("light.bf1_den_lamp3","brightness") / 254 * 100 ) | int(100) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_brightness") | int(100) ) }}
            {% endif %}
          brightness_max: >-
            {{ state_attr("binary_sensor.bf1_den_lamp3_autobrightness", "brightness") | int(100) + 4 }}
          brightness_min: >-
            {{ state_attr("binary_sensor.bf1_den_lamp3_autobrightness", "brightness") | int(100) - 4 }}

      - unique_id: "42bff3a4-7a1f-425e-859e-5ba054684ed6"
        name: "BF1: Den Lamp3 - Autocolor"
        state: >-
          {{ (
               states("sensor.global_dummy_light_color_temperature") | int(367) ) <
               ( state_attr("binary_sensor.bf1_den_lamp3_autocolor", "color_temp_max")
               | int(371) )
             and ( states("sensor.global_dummy_light_color_temperature") | int(367) ) >
             ( state_attr("binary_sensor.bf1_den_lamp3_autocolor", "color_temp_min") | int(363)
             ) }}
        attributes:
          color_temp: >-
            {% if state_attr("light.bf1_den_lamp3", "color_temp") is number %}
              {{ state_attr("light.bf1_den_lamp3","color_temp") | int(367) }}
            {% else %}
              {{ ( states("sensor.global_dummy_light_color_temperature") | int(367) ) }}
            {% endif %}
          color_temp_max: >-
            {{ state_attr("binary_sensor.bf1_den_lamp3_autocolor", "color_temp") | int(100) + 4 }}
          color_temp_min: >-
            {{ state_attr("binary_sensor.bf1_den_lamp3_autocolor", "color_temp") | int(100) - 4 }}

  - sensor:
      # ============================================================================================
      #
      # BF1: Den (Whole Room) Sensors
      #
      # ============================================================================================
      - unique_id: "70e951ee-3ef0-488c-b426-6a77326b904a"
        name: "BF1: Den Color"
        state: "{{ state_attr('light.bf1_den', 'xy_color') }}"

      # ============================================================================================
      #
      # BF1: Den CF1 Sensors
      #
      # ============================================================================================
      - unique_id: "337ca313-fe2a-48b6-a6f4-ddfe11fec06f"
        name: "BF1: Den CF1 Color"
        state: "{{ state_attr('light.bf1_den_cf1', 'xy_color') }}"

      # ============================================================================================
      #
      # BF1: Den CF2 Sensors
      #
      # ============================================================================================
      - unique_id: "0a8b5637-0b31-4e51-86d8-a9b27c8f74dc"
        name: "BF1: Den CF2 Color"
        state: "{{ state_attr('light.bf1_den_cf2', 'xy_color') }}"

      # ============================================================================================
      #
      # BF1: Den Lamp1 Sensors
      #
      # ============================================================================================
      - unique_id: "764b1552-4941-4907-a408-f7e6048a01f8"
        name: "BF1: Den Lamp1 Color"
        state: "{{ state_attr('light.bf1_den_lamp1', 'xy_color') }}"

      # ============================================================================================
      #
      # BF1: Den Lamp2 Sensors
      #
      # ============================================================================================
      - unique_id: "92495cab-1e50-440b-936b-b22f96b7939a"
        name: "BF1: Den Lamp2 Color"
        state: "{{ state_attr('light.bf1_den_lamp2', 'xy_color') }}"

      # ============================================================================================
      #
      # BF1: Den Lamp3 Sensors
      #
      # ============================================================================================
      - unique_id: "38deaa3d-efea-4cdf-824d-deb2cd580039"
        name: "BF1: Den Lamp3 Color"
        state: "{{ state_attr('light.bf1_den_lamp3', 'xy_color') }}"
